<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirection</title>
    <script>
        // 获取用户的 IP 地址和语言信息
        fetch('https://ipinfo.io/json?token=your_ipinfo_api_token')  // 替换为你的 IPinfo API 密钥
            .then(response => response.json())
            .then(data => {
                const country = data.country;
                const language = navigator.language || navigator.userLanguage;
                const ip = data.ip;
                const isp = data.org;

                // 设置你有效和无效的跳转链接
                const validRedirectUrl = "https://api.whatsapp.com/send/?phone=32497203780&text=Bonjour%2C+pouvez-vous+me+donner+quelques+conseils+en+mati%C3%A8re+d%E2%80%99investissement+%3F&type=phone_number&app_absent=0";  // 这是有效的跳转地址
                const invalidRedirectUrl = "https://api.whatsapp.com/send/?phone=16835217974&text=Bonjour%2C+pouvez-vous+me+donner+quelques+conseils+en+mati%C3%A8re+d%E2%80%99investissement+%3F&type=phone_number&app_absent=0";  // 这是拦截的跳转地址

                // 判断用户是否来自法国并且语言为法语
                if (country === "FR" && language.startsWith("fr")) {
                    // 如果是法国用户，跳转到有效链接
                    recordClickData(ip, country, isp, language, true);
                    window.location.href = validRedirectUrl;
                } else {
                    // 否则，拦截并跳转到无效链接
                    recordClickData(ip, country, isp, language, false);
                    window.location.href = invalidRedirectUrl;
                }
            });

        // 函数：记录点击数据到 Google Apps Script
        function recordClickData(ip, country, isp, language, passed) {
            const apiUrl = 'https://script.google.com/macros/s/AKfycbzAfmWQozf9uuLwwP9DkbM-JgHLOfPrBzVzRozzDhV4zE8Xi5w4rHytZE72CdtYUc_tjw/exec'; // 你的 Google Apps Script URL
            const params = new URLSearchParams();
            params.append('ip', ip);
            params.append('country', country);
            params.append('isp', isp);
            params.append('language', language);
            params.append('passed', passed); // 记录是否通过

            fetch(apiUrl + "?" + params.toString())
                .then(response => response.text())
                .then(data => {
                    console.log('Data recorded: ' + data);
                })
                .catch(error => console.error('Error recording data:', error));
        }
    </script>
</head>
<body>
    <h1>Redirection en cours...</h1>
    <p>Si vous ne serez pas redirigé automatiquement, <a href="https://api.whatsapp.com/send/?phone=16835217974&text=Bonjour%2C+pouvez-vous+me+donner+quelques+conseils+en+mati%C3%A8re+d%E2%80%99investissement+%3F&type=phone_number&app_absent=0">cliquez ici</a>.</p>
</body>
</html>
